<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <!--skip-->
        <title>Accuratus Chat Window</title>
        <link rel="stylesheet" type="text/css" href="/easyrtc/easyrtc.css" />

        <!--hide-->
        <link rel="stylesheet" type="text/css" href="css/landing.css" />
        <link rel="stylesheet" type="text/css" href="css/demo_audio_video_simple.css" />
        <!-- Prettify Code -->
        <script type="text/javascript" src="js/prettify/prettify.js"></script>
        <script type="text/javascript" src="js/prettify/loadAndFilter.js"></script>
        <script type="text/javascript" src="js/prettify/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="js/prettify/prettify.css" />
        	
        <!--show-->
        <!-- Assumes global locations for socket.io.js and easyrtc.js -->
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="/easyrtc/easyrtc.js"></script>
        <script type="text/javascript" src="js/demo_audio_video_simple.js"></script>
        
        
         <script>
            if(location.href.indexOf('file:') == 0) {
                document.write('<h1 style="color:red;">Please load this HTML file on HTTP or HTTPS.</h1>');
            }
        </script>
		
    </head>
    <body onload="connect();">
        <!--hide-->
        <div id="containercaller">
            
             <div id="menu"></div>
            

<div id="main">          
                <h2>The Accuratus Chat Application</h2>
                <!--show-->
                <div id="demoContainer">
                    <div id="connectControls">
                        <div id="iam">Not yet connected...</div>
                        <br />
                        <strong>Connected users:</strong>
                        <div id="otherClients"></div>
                    </div>
                    <div id="videos">
                        
                <div style="position:relative;float:left;">                        
                <video autoplay="autoplay" id="callerVideo"  controls></video>
                </div>
                
                <video autoplay="autoplay" class="easyrtcMirror" id="selfVideo" muted="muted"></video>
                                       
                <!-- each caller video needs to be in it's own div so it's close button can be positioned correctly -->
                    </div>
                    
                
                    
                    
                </div>
                <!--hide-->
                <br style="clear:both;" />
                <hr />



                <!-- Runs the SyntaxHighlighter -->
               

                <!-- End Main Content -->
            </div>
            
        </div>

             
             <script>
var startRecording = document.getElementById('start-recording');
var stopRecording = document.getElementById('stop-recording');
var cameraPreview = document.getElementById('callerVideo');

var mRecordRTC = new MRecordRTC();
mRecordRTC.mediaType = {
	audio: true,
	video: true
};

mRecordRTC.bufferSize = 16384;
mRecordRTC.canvas = {
	width: innerWidth,
	height: innerHeight
};

var recordAudio, recordVideo;
startRecording.onclick = function() {
    startRecording.disabled = true;
    var video_constraints = {
        mandatory: { },
        optional: []
    };
   

            mRecordRTC.addStream(stream);
			mRecordRTC.startRecording();

          
};

var fileName;
stopRecording.onclick = function() {
    startRecording.disabled = false;
    stopRecording.disabled = true;

    fileName = Math.round(Math.random() * 99999999) + 99999999;

    mRecordRTC.stopRecording();

    mRecordRTC.getDataURL(function(dataURL) {
        var files = {
                audio: {
                    name: fileName + '.wav',
                    type: 'audio/wav',
                    contents: dataURL.audio
                },
                video: {
                    name: fileName + '.webm',
                    type: 'video/webm',
                    contents: dataURL.video
                }
            };

            cameraPreview.src = '';
            cameraPreview.poster = '/ajax-loader.gif';

            xhr('/upload', JSON.stringify(files), function(fileName) {
                var href = location.href.substr(0, location.href.lastIndexOf('/') + 1);
                cameraPreview.src = href + 'uploads/' + fileName;
                cameraPreview.play();
            });
    });
};

function xhr(url, data, callback) {
    var request = new XMLHttpRequest();
    request.onreadystatechange = function() {
        if (request.readyState == 4 && request.status == 200) {
            callback(request.responseText);
        }
    };
    request.open('POST', url);
    request.send(data);
}		

</script>



<script>
var instmsgurl=document.URL;
var instmsgurl1=instmsgurl.substring(0,instmsgurl.lastIndexOf("/"));
var instmsgurl2=instmsgurl1+"/demo_instant_messaging_caller.html";
var instmsgurl3=instmsgurl1+"/demo_data_channel_filesharing_caller.html";

var instmsgurl4=instmsgurl1+"/details.html";
document.write("<iframe src="+instmsgurl2+" width=\"990\" height=\"320\" id=\"containercaller2\"></iframe>"); 

document.write("<iframe src="+instmsgurl3+" width=\"990\" height=\"250\" id=\"containercaller1\"></iframe>"); 

document.write("<iframe src="+instmsgurl4+" width=\"990\" height=\"250\" id=\"containercaller4\"></iframe>");
</script>


          
        <!--show-->
    </body>
</html>
